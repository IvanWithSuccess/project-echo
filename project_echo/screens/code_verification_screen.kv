<CodeVerificationScreen>:
    name: "code_verification_screen"

    MDRelativeLayout:

        # Back button
        MDIconButton:
            icon: "arrow-left"
            pos_hint: {"top": 0.98, "x": 0.02}
            on_release: app.root.ids.screen_manager.current = 'login_screen'

        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: None
            width: dp(400)
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            spacing: dp(20)

            MDLabel:
                text: "Enter Code"
                halign: 'center'
                font_style: 'H5'
                adaptive_height: True
                padding_y: dp(15)

            MDLabel:
                text: "We have sent you a message\nwith the confirmation code."
                halign: 'center'
                adaptive_height: True
                theme_text_color: "Secondary"

            MDTextField:
                id: code_field
                hint_text: "Confirmation Code"
                mode: "fill"
                halign: "center"
                line_color_focus: (36/255, 161/255, 222/255, 1)

            MDTextField:
                id: password_field
                hint_text: "2FA Password (if any)"
                password: True
                mode: "fill"
                halign: "center"
                line_color_focus: (36/255, 161/255, 222/255, 1)

            MDRaisedButton:
                text: "CONFIRM"
                md_bg_color: (36/255, 161/255, 222/255, 1)
                pos_hint: {'center_x': 0.5}
                size_hint_x: 1
                padding_y: dp(15)
                on_release: root.verify_code()

        # FIX: Add a spinner for loading indication
        MDSpinner:
            id: spinner
            size_hint: None, None
            size: dp(46), dp(46)
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            active: False # Initially hidden
