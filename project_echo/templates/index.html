<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Echo</title>

    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- Material Web Components -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/@material/web/all.js?render-blocking=true"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="app-layout">
        <div class="sidebar">
            <h2 class="app-title">Project Echo</h2>
            <nav>
                <div class="nav-item" id="nav-dashboard" onclick="switchSection('dashboard')">
                    <span class="material-symbols-outlined">dashboard</span>
                    Dashboard
                </div>
                <div class="nav-item" id="nav-accounts" onclick="switchSection('accounts')">
                    <span class="material-symbols-outlined">group</span>
                    Accounts Center
                </div>
                <div class="nav-item" id="nav-audiences" onclick="switchSection('audiences')">
                    <span class="material-symbols-outlined">folder_shared</span>
                    Audience CRM
                </div>
                <div class="nav-item" id="nav-campaigns" onclick="switchSection('campaigns')">
                    <span class="material-symbols-outlined">campaign</span>
                    Ad Cabinet
                </div>
                <div class="nav-item" id="nav-proxies" onclick="switchSection('proxies')">
                    <span class="material-symbols-outlined">lan</span>
                    Proxies
                </div>
                <div class="nav-item" id="nav-tasks" onclick="switchSection('tasks')">
                    <span class="material-symbols-outlined">pending_actions</span>
                     Task Center
                </div>
                <div class="nav-item" id="nav-settings" onclick="switchSection('settings')">
                    <span class="material-symbols-outlined">settings</span>
                    Settings
                </div>
            </nav>
        </div>

        <main class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section">
                <h1>Dashboard</h1>
                <p>Welcome to Project Echo. Here's a summary of your activities.</p>
            </div>

            <!-- Accounts Center Section -->
            <div id="accounts" class="content-section">
                <div class="section-header">
                    <h1>Accounts Center</h1>
                    <div class="header-actions">
                        <md-outlined-button onclick="openTagsDialog()">Manage Tags</md-outlined-button>
                        <md-filled-button onclick="addAccount()">
                            Add Account
                            <span class="material-symbols-outlined" slot="icon">add</span>
                        </md-filled-button>
                    </div>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Phone</th>
                            <th>Username</th>
                            <th>Tags</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="accounts-table-body"></tbody>
                </table>
            </div>
            
            <!-- Account Settings Page -->
            <div id="account-settings" class="content-section">
                <div class="section-header">
                     <md-text-button onclick="showMainAccountsPage()">
                        <span class="material-symbols-outlined" slot="icon">arrow_back</span>
                        Back to Accounts
                    </md-text-button>
                    <h1>Settings for <span id="settings-account-display-phone"></span></h1>
                    <input type="hidden" id="settings-account-phone">
                </div>

                <md-tabs aria-label="Account Settings Tabs">
                    <md-primary-tab id="tab-main-settings" aria-controls="main-settings-panel">
                        <span class="material-symbols-outlined" slot="icon">tune</span>
                        Main
                    </md-primary-tab>
                    <md-primary-tab id="tab-proxy-settings" aria-controls="proxy-settings-panel">
                         <span class="material-symbols-outlined" slot="icon">lan</span>
                        Proxy
                    </md-primary-tab>
                </md-tabs>

                <div id="main-settings-panel" class="tab-panel" role="tabpanel" aria-labelledby="tab-main-settings">
                     <div class="form-grid">
                        <div class="avatar-section">
                            <h3>Avatar</h3>
                            <img id="avatar-preview" src="" alt="Avatar Preview" style="display:none;"/>
                            <input type="file" id="avatar-upload-input" onchange="handleAvatarUpload()" accept="image/png, image/jpeg" style="display: none;">
                            <md-outlined-button onclick="document.getElementById('avatar-upload-input').click()">
                                Upload Image
                            </md-outlined-button>
                            <input type="hidden" id="account-avatar-path">
                        </div>
                        <div class="profile-fields">
                             <h3>Profile</h3>
                            <md-outlined-text-field id="account-first-name" label="First Name"></md-outlined-text-field>
                            <md-outlined-text-field id="account-last-name" label="Last Name"></md-outlined-text-field>
                            <md-outlined-text-field id="account-bio" type="textarea" rows="3" label="Bio (max 70 chars)" maxLength="70"></md-outlined-text-field>
                        </div>
                     </div>
                     <div class="form-section">
                        <h3>User Agent</h3>
                         <div class="form-grid-3">
                            <md-outlined-select id="ua-os" label="Operating System">
                                <md-select-option selected value="Windows"></md-select-option>
                                <md-select-option value="macOS"></md-select-option>
                                <md-select-option value="Linux"></md-select-option>
                            </md-outlined-select>
                            <md-outlined-text-field id="ua-chrome-version" label="Chrome Version" value="108.0.5359.215"></md-outlined-text-field>
                            <md-outlined-button onclick="generateUserAgent()">Generate</md-outlined-button>
                        </div>
                        <md-outlined-text-field id="account-user-agent-input" label="Telethon System Version String" style="width: 100%;"></md-outlined-text-field>
                    </div>
                    <div class="form-actions">
                        <md-outlined-button onclick="saveAccountSettings()">Save Settings</md-outlined-button>
                        <md-filled-button onclick="applyProfileChanges()">Apply to Telegram</md-filled-button>
                    </div>
                </div>

                <div id="proxy-settings-panel" class="tab-panel" role="tabpanel" aria-labelledby="tab-proxy-settings">
                    <h3>Proxy Selection</h3>
                    <p>Select a proxy from the list below. You can add more in the <a href="#" onclick="switchSection('proxies')">Proxies</a> section.</p>
                    <md-outlined-select id="account-proxy-select" label="Select Proxy">
                        <md-select-option value=""></md-select-option> <!-- No Proxy -->
                    </md-outlined-select>
                    <div class="form-actions">
                        <md-filled-button onclick="saveAccountSettings()">Save Proxy Setting</md-filled-button>
                    </div>
                </div>
            </div>

            <!-- Audience CRM Section -->
            <div id="audiences" class="content-section">
                <div class="section-header"><h1>Audience CRM</h1></div>
                <div class="form-section card">
                    <h3>Scrape New Audience</h3>
                    <div class="form-grid-responsive">
                        <md-outlined-select id="scraper-account-select" label="Account for scraping">
                            <md-select-option></md-select-option>
                        </md-outlined-select>
                        <md-outlined-text-field id="scraper-chat-link" label="Public chat link (t.me/chat)"></md-outlined-text-field>
                        <md-filled-button onclick="scrapeAudience()">
                            Scrape Users
                            <span slot="icon" class="material-symbols-outlined">psychology</span>
                        </md-filled-button>
                    </div>
                    <p id="scraper-status"></p>
                </div>
                
                <div id="audience-results-container" style="display: none;">
                    <h3>Scraping Results</h3>
                    <div class="form-actions">
                        <md-outlined-text-field id="save-audience-name" label="Audience Name"></md-outlined-text-field>
                        <md-filled-button onclick="saveAudience()">
                            Save Audience
                            <span slot="icon" class="material-symbols-outlined">save</span>
                        </md-filled-button>
                    </div>
                    <table class="data-table">
                        <thead><tr><th>ID</th><th>Username</th><th>Name</th><th>Phone</th></tr></thead>
                        <tbody id="audience-table-body"></tbody>
                    </table>
                </div>

                <h3>Saved Audiences</h3>
                <div id="saved-audiences-list" class="list-container"></div>
            </div>

            <!-- Ad Cabinet Section -->
            <div id="campaigns" class="content-section">
                <div class="section-header"><h1>Ad Cabinet</h1></div>
                <div class="form-section card">
                    <h3>Create New Campaign</h3>
                    <div class="form-grid-campaign">
                        <md-outlined-text-field id="campaign-name" label="Campaign Name"></md-outlined-text-field>
                        <md-outlined-select id="campaign-audience-select" label="Select Audience"></md-outlined-select>
                    </div>
                    <div class="form-section">
                        <h4>Select accounts for sending</h4>
                        <div id="campaign-accounts-list" class="checkbox-list"></div>
                    </div>
                    <div class="form-section">
                        <h4>Message</h4>
                        <md-outlined-text-field id="campaign-message" type="textarea" rows="5" label="Your message text here"></md-outlined-text-field>
                    </div>
                    <div class="form-actions">
                        <md-filled-button onclick="startCampaign()">
                            Start Campaign
                            <span slot="icon" class="material-symbols-outlined">rocket_launch</span>
                        </md-filled-button>
                    </div>
                </div>
                <h3>Campaigns</h3>
                <table class="data-table">
                    <thead><tr><th>Name</th><th>Audience</th><th>Progress</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead>
                    <tbody id="campaigns-table-body"></tbody>
                </table>
            </div>

            <!-- Proxies Section -->
            <div id="proxies" class="content-section">
                <div class="section-header"><h1>Proxy Manager</h1></div>
                <div class="form-section card">
                    <h3>Add New Proxy</h3>
                    <div class="form-grid-responsive">
                         <md-outlined-select id="proxy-add-type" label="Type">
                            <md-select-option selected value="socks5">SOCKS5</md-select-option>
                            <md-select-option value="http">HTTP</md-select-option>
                        </md-outlined-select>
                        <md-outlined-text-field id="proxy-add-host" label="Host / IP Address"></md-outlined-text-field>
                        <md-outlined-text-field id="proxy-add-port" label="Port" type="number"></md-outlined-text-field>
                        <md-outlined-text-field id="proxy-add-user" label="Username (optional)"></md-outlined-text-field>
                        <md-outlined-text-field id="proxy-add-pass" label="Password (optional)" type="password"></md-outlined-text-field>
                    </div>
                    <div class="form-actions">
                         <md-filled-button onclick="addProxy()">Add Proxy</md-filled-button>
                    </div>
                </div>
                <table class="data-table">
                    <thead><tr><th>Host</th><th>Port</th><th>Username</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="proxies-table-body"></tbody>
                </table>
            </div>

            <!-- Other placeholder sections -->
            <div id="tasks" class="content-section"><div class="section-header"><h1>Task Center</h1></div></div>
            <div id="settings" class="content-section"><div class="section-header"><h1>Settings</h1></div></div>
        </main>
    </div>

    <!-- Tags Management Dialog -->
    <md-dialog id="tags-dialog">
        <div slot="headline">Manage Account Tags</div>
        <div slot="content" class="dialog-content">
            <div class="form-section">
                <md-outlined-text-field id="tag-add-name" label="New tag name"></md-outlined-text-field>
                <md-filled-button onclick="addTag()">Add Tag</md-filled-button>
            </div>
            <div id="tags-list" class="tags-container"></div>
        </div>
        <div slot="actions">
            <md-text-button onclick="document.getElementById('tags-dialog').close()">Close</md-text-button>
        </div>
    </md-dialog>
    
    <script src="/static/app.js"></script>
</body>
</html>
