#:kivy 2.0
#:import Window kivy.core.window.Window
#:import NoTransition kivy.uix.screenmanager.NoTransition

# A more advanced NavButton that contains a sized Image
<NavButton@FloatLayout>:
    size_hint_y: None
    height: '50dp' # Reduced button height
    source: ''      # Property for the icon path
    panel_name: '' # Property for the panel to switch to

    # The behavior that makes the layout clickable
    ButtonBehavior:
        # When released, call the app's switch_panel method with the correct panel name
        on_release: app.switch_panel(root.panel_name)

    # The actual icon image
    Image:
        source: root.source # Link to the source property of the NavButton
        size_hint: None, None
        # Set a fixed size for the icon, e.g., 28x28 pixels
        # This is about 3-4 times smaller than the previous 60dp.
        size: (dp(28), dp(28))
        # Center the image inside the FloatLayout
        pos_hint: {'center_x': 0.5, 'center_y': 0.5}

# --- The ONE Root Widget ---
BoxLayout:
    orientation: 'horizontal'

    # 1. Navigation Panel (Left Side)
    BoxLayout:
        id: nav_panel
        orientation: 'vertical'
        size_hint_x: None
        width: '80dp'
        padding: '10dp'
        spacing: '15dp' # Increased spacing a bit
        canvas.before:
            Color:
                rgba: (0.95, 0.95, 0.95, 1)
            Rectangle:
                pos: self.pos
                size: self.size

        Label:
            text: 'E'
            font_size: '30sp'
            bold: True
            size_hint_y: None
            height: '48dp'
            color: (0, 0, 0, 1)

        # Use the new NavButton with source and panel_name properties
        NavButton:
            panel_name: 'dashboard'
            source: 'assets/icons/dashboard.png'

        NavButton:
            panel_name: 'accounts'
            source: 'assets/icons/accounts.png'

        NavButton:
            panel_name: 'campaigns'
            source: 'assets/icons/campaigns.png'

        Widget: # Spacer
            size_hint_y: 1.0

    # 2. Content Panel (Right Side)
    BoxLayout:
        id: content_panel
        canvas.before:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                pos: self.pos
                size: self.size
        
        ScreenManager:
            id: screen_manager
            transition: NoTransition()

            Screen:
                name: 'dashboard'
                Label:
                    text: "Dashboard content here"
                    color: (0, 0, 0, 1)
            
            Screen:
                name: 'accounts'
                AccountsPanel:
                    id: accounts_panel

            Screen:
                name: 'campaigns'
                Label:
                    text: "Campaigns content will be here"
                    color: (0, 0, 0, 1)

            Screen:
                name: 'login'
                LoginScreen:
                    id: login_screen

            Screen:
                name: 'code_verification'
                CodeVerificationScreen:
                    id: code_verification_screen

            Screen:
                name: 'password_verification'
                PasswordVerificationScreen:
                    id: password_verification_screen
